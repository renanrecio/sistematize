<!DOCTYPE html>
<html>
<head>

<link rel="stylesheet" type="text/css" href="Folha_Estilo.css" media="screen" />

<script>
var id_loja = '87';

var id_usuario_escolhido = localStorage.id_usuario_chat;
</script>

<link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>

<style>
p, input, span,a,li,placeholder,select,option,td,tr{
	font-family: 'Montserrat', sans-serif;
}

body{
	
	background-color: #F9F9F9;
}
</style>
<style>

.msg{
    background: #dcf8c6;
    border-radius: 10px;
    max-width: 80%;
	min-width: 30%;	
    height: auto;
	width: auto;
	
	right:2%;
}

.msg:after{

    content: "";

    width: 0;
    height: 0;

    position: relative;

    border-left: 20px solid transparent;
    border-right: 20px solid transparent;
    border-top: 20px solid #dcf8c6;

    top: 2.25em;
    right: 0%;
}


.msg2{
    background: #e6e6e6;
    border-radius: 10px;
    max-width: 60%;
	min-width: 30%;	
	min-height: 25px;
    height: auto;
	width: auto;
	
	left:2%;
}


.caixa_msg{
    background: #e6e6e6;
    border-radius: 10px;
    
}

.enviar{
    background: #0052cc;
    border-radius: 10px;

}

</style>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script type="text/javascript">
/*   
   window.onload = function(){
		$('.cabecalho').fadeOut();
	}	
	
	$(function () {
		
        $(window).scroll(function () {
            if ($(this).scrollTop() > 100) {
                $('.cabecalho').fadeIn();
            } else {
                $('.cabecalho').fadeOut();
            }
			
        });
    });
	*/
</script>

<script>

var aberto=0;
function abrir_telefone(){
	
	if(aberto == 0){
		document.getElementById("telefone").style.visibility="visible";
		document.getElementById("info").style.visibility="hidden";
		aberto=1;
		aberto2=0;
	}else{
		
		document.getElementById("telefone").style.visibility="hidden";
		aberto=0;
	}
}

var aberto2=0;
function abrir_info(){
	
	if(aberto2 == 0){
		document.getElementById("info").style.visibility="visible";
		document.getElementById("telefone").style.visibility="hidden";
		aberto2=1;
		aberto=0;
	}else{
		
		document.getElementById("info").style.visibility="hidden";
		aberto2=0;
	}
}

</script>




<script type="text/javascript">
			var xmlHttp;
			

			function createXMLHttpRequest_envia() {
			if (window.ActiveXObject) {
			xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			else if (window.XMLHttpRequest) {
			xmlHttp = new XMLHttpRequest();
			}
			}

			function startRequest_chat_envia(mensagem) {
			createXMLHttpRequest_envia();
			xmlHttp.onreadystatechange = handleStateChange_envia;
			

			
			xmlHttp.open("POST", "http://54.207.38.125/AcheLoja2.0/sistematize/ajax_chat_enviar.php", true);
			
			
			
			xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			
			//alert("id_loja="+id_loja+"&id_usuario="+localStorage.id_usuario+"&quem_envia=usuario&mensagem="+mensagem+"");
			
			xmlHttp.send("id_loja="+id_loja+"&id_usuario="+id_usuario_escolhido+"&quem_envia=lojista&mensagem="+mensagem+"");
			

			
			
			}

			
			function handleStateChange_envia() {
			if(xmlHttp.readyState == 4) {
			if(xmlHttp.status == 200) {
			//document.getElementById("resultado").innerHTML = xmlHttp.responseText.trim();
			//document.getElementById("verifica_login").value = xmlHttp.responseText.trim();
			
			   //alert('enviou');
			   
			   startRequest_chat_atualiza();
			
			}
			}
			}
			
		
			
</script>   


	


<script type="text/javascript">
			var top_ultimo_prod;
			var cidade;
			var cep_bairro;
			var str;
			
			var id = 0;
					
			var id_antigo;

			var height_antigo;

			var top_ = 100;

			var top2;

			var span;
			
			var msg;
			
			var ultimo_index;
			
			var obj;
			
			var data_msg_mais_recente;

			function createXMLHttpRequest() {
			if (window.ActiveXObject) {
			xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			else if (window.XMLHttpRequest) {
			xmlHttp = new XMLHttpRequest();
			}
			}

			function startRequest_chat() {
			createXMLHttpRequest();
			xmlHttp.onreadystatechange = handleStateChange;
			
			
			//xmlHttp.open("POST", "https://acheloja.com/m/ajax_vitrine_app.php", true);
			//xmlHttp.open("POST", "http://52.67.44.156/m/ajax_vitrine_app.php", true);
			//xmlHttp.open("POST", "https://acheloja.com/sistematize/ajax_vitrine_app.php", true);
			
			
			xmlHttp.open("POST", "http://54.207.38.125/AcheLoja2.0/sistematize/ajax_chat_app.php", true);
			
			
			
			xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			
			//xmlHttp.send("nick_site="+localStorage.nick_site+"&id_usuario="+localStorage.id_usuario);
			xmlHttp.send("id_loja="+id_loja+"&id_usuario="+id_usuario_escolhido);
			
			document.getElementById("img_carregando_produtos").style.visibility = "visible";
			
			
			}

			
			function handleStateChange() {
			if(xmlHttp.readyState == 4) {
			if(xmlHttp.status == 200) {
			//document.getElementById("resultado").innerHTML = xmlHttp.responseText.trim();
			//document.getElementById("verifica_login").value = xmlHttp.responseText.trim();
			
				str = xmlHttp.responseText.trim();
				
				
				obj = JSON.parse(str);
			
				
				//document.getElementById("div_chat").innerHTML = obj[1].id + ", " + obj[1].mensagem;

				ultimo_index = (obj.length) - 1;
				
				data_msg_mais_recente = obj[0].data_envio;
				
				//for (i = 0; i < obj.length; i++) { 
				for (i = ultimo_index; i >= 0; i--) { 

					msg = obj[i].mensagem;
					
						if( msg != ''){
						
							if(id==0){
							
								height_antigo= 0;
								
								
							}else{
								id_antigo = id - 1;
								height_antigo = (document.getElementById('msg'+id_antigo).clientHeight)+30;

							}
							
							top_ = 	top_ + height_antigo;
							
						
							if( obj[i].quem_envia == "lojista"){
								
								span = '<span class="msg" id="msg'+id+'" style=" position:absolute; top: '+top_+'px; font-size:1em; color: black; line-height:1em;  text-align: left; padding: 10px 10px 10px 10px; " >'+msg+'</span>';
							
							}else{
								
								span = '<span class="msg2" id="msg'+id+'" style=" position:absolute; top: '+top_+'px; font-size:1em; color: black; line-height:1em;  text-align: left; padding: 10px 10px 10px 10px; " >'+msg+'</span>';
							
							}//fim do else	
								
								
							$('#div_chat').append( span );
							
							height_antigo = (document.getElementById('msg'+id).clientHeight)+30;
								
							top2 = 	top_ + height_antigo;
							
							span_espaco = '<span class="msg2" id="espaco" style=" position:absolute; top: '+top2+'px; font-size:2em; color: black; line-height:1em; height:2.5em; background:transparent;  text-align: left; padding: 20px 20px 20px 20px; " ></span>';

							$('#div_chat').append( span_espaco );
							
							id = id + 1;
							
						}	//fim do if
						
				}//fim do for
				
				//document.getElementById("div_chat").innerHTML = document.getElementById("div_chat").innerHTML + str;
				document.getElementById("img_carregando_produtos").style.visibility = "hidden";
				
				document.body.scrollTop = document.body.scrollHeight;
							

				
			}
			}
			}
			
		
			
		startRequest_chat();
			
</script>   




	<div id="div_chat" name="div_chat">


	</div>
	
	
	

<!-- Inserir novas msg online -->	
<script type="text/javascript">

			function createXMLHttpRequest_chat_atualiza() {
			if (window.ActiveXObject) {
			xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			else if (window.XMLHttpRequest) {
			xmlHttp = new XMLHttpRequest();
			}
			}

			function startRequest_chat_atualiza() {
			createXMLHttpRequest_chat_atualiza();
			xmlHttp.onreadystatechange = handleStateChange_chat_atualiza;
			
			
			//xmlHttp.open("POST", "https://acheloja.com/m/ajax_vitrine_app.php", true);
			//xmlHttp.open("POST", "http://52.67.44.156/m/ajax_vitrine_app.php", true);
			//xmlHttp.open("POST", "https://acheloja.com/sistematize/ajax_vitrine_app.php", true);
			
			
			xmlHttp.open("POST", "http://54.207.38.125/AcheLoja2.0/sistematize/ajax_chat_app_atualiza.php", true);
			
			
			xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			
			//xmlHttp.send("nick_site="+localStorage.nick_site+"&id_usuario="+localStorage.id_usuario);
			
			xmlHttp.send("id_loja="+id_loja+"&id_usuario="+id_usuario_escolhido+"&data_msg_mais_recente="+data_msg_mais_recente+'');
			
			
			//document.getElementById("img_carregando_produtos").style.visibility = "visible";
			
			
			}

			
			function handleStateChange_chat_atualiza() {
			if(xmlHttp.readyState == 4) {
			if(xmlHttp.status == 200) {
			//document.getElementById("resultado").innerHTML = xmlHttp.responseText.trim();
			//document.getElementById("verifica_login").value = xmlHttp.responseText.trim();
			
				str = xmlHttp.responseText.trim();
				
				
				obj = JSON.parse(str);
			
				
				//document.getElementById("div_chat").innerHTML = obj[1].id + ", " + obj[1].mensagem;

				ultimo_index = (obj.length) - 1;
				
				data_msg_mais_recente = obj[0].data_envio;
				
				//for (i = 0; i < obj.length; i++) { 
				for (i = ultimo_index; i >= 0; i--) { 

					msg = obj[i].mensagem;
					
						if( msg != ''){
						
							if(id==0){
							
								height_antigo= 0;
								
								
							}else{
								id_antigo = id - 1;
								height_antigo = (document.getElementById('msg'+id_antigo).clientHeight)+30;

							}
							
							top_ = 	top_ + height_antigo;
							
						
							if( obj[i].quem_envia == "lojista"){
								
								span = '<span class="msg" id="msg'+id+'" style=" position:absolute; top: '+top_+'px; font-size:1em; color: black; line-height:1em;  text-align: left; padding: 10px 10px 10px 10px; " >'+msg+'</span>';
							
							}else{
								
								span = '<span class="msg2" id="msg'+id+'" style=" position:absolute; top: '+top_+'px; font-size:1em; color: black; line-height:1em;  text-align: left; padding: 10px 10px 10px 10px; " >'+msg+'</span>';
							
							}//fim do else	
								
								
							$('#div_chat').append( span );
							
							height_antigo = (document.getElementById('msg'+id).clientHeight)+30;
								
							top2 = 	top_ + height_antigo;
							
							span_espaco = '<span class="msg2" id="espaco" style=" position:absolute; top: '+top2+'px; font-size:2em; color: black; line-height:1em; height:2.5em; background:transparent;  text-align: left; padding: 20px 20px 20px 20px; " ></span>';

							$('#div_chat').append( span_espaco );
							
							id = id + 1;
							
						}	//fim do if
						
				}//fim do for
				
				//document.getElementById("div_chat").innerHTML = document.getElementById("div_chat").innerHTML + str;
				//document.getElementById("img_carregando_produtos").style.visibility = "hidden";
				
				document.body.scrollTop = document.body.scrollHeight;
							

				
			}
			}
			}
			
		
			
</script>   
	
<!--	
	<div  style="position:fixed; width: 100%;  bottom:3em; right:0%; height: 3.5em;">

			<textarea class="caixa_msg" id="mensagem_escrita" style="resize: none; width:85%;"  rows="4" cols="50" placeholder="Escreva sua mensagem"></textarea>
	
		<div class="enviar" >
		    <center>
			<span onclick="enviar()" style="cursor: pointer; position:relative; top: 0.5em; left:1%; font-size: 0.9em; width:10%;  color: white; line-height:1em;  " > ENVIAR </span>
			</center>
		</div>

	</div>	
-->	

	<div  style="position:fixed; width: 100%;  bottom:3em; right:0%; height: 3.5em;">

			<textarea class="caixa_msg" id="mensagem_escrita" style=" position: absolute; top:0em; resize: none; width: 70%; left:1%; height: 3em; "  rows="4" cols="50" placeholder="Escreva sua mensagem"></textarea>


			<span  class="enviar" onclick="enviar()" style="position:absolute; top: 0.5em; width: 25%; height: 2em; right:1%; font-size: 0.9em; color: white; line-height:2em;  " > ENVIAR </span>

		</div>


	</div>	


<script type="text/javascript" src="https://code.jquery.com/jquery-1.5.1.min.js"></script> 
<script>

	//var id = 1;
	
	//var top_ = 100;//$("#msg"+id).offset().top;
	
	//var top2;
	
	//var height_antigo;
	
function enviar(){

   	msg = document.getElementById('mensagem_escrita').value;
	
	startRequest_chat_envia(msg);
	
	document.getElementById('mensagem_escrita').value = '';

	/*
	var span;
	
	var msg = document.getElementById('mensagem_escrita').value;
	
	
	if( msg != ''){
	
		if(id==0){
		
			height_antigo= 0;
			
		}else{
		
			id_antigo = id - 1;
			height_antigo = (document.getElementById('msg'+id_antigo).clientHeight)+30;
		}
		top_ = 	top_ + height_antigo;
		
		span = '<span class="msg" id="msg'+id+'" style=" position:absolute; top: '+top_+'px; font-size:1em; color: black; line-height:1em;  text-align: left; padding: 10px 10px 10px 10px; " >'+msg+'</span>';

		$('#div_chat').append( span );
		
		document.getElementById('msg'+id).style.wordWrap = "break-word";
		
		height_antigo = (document.getElementById('msg'+id).clientHeight)+30;
			
		top2 = 	top_ + height_antigo;
		
		span_espaco = '<span class="msg2" id="espaco" style=" position:absolute; top: '+top2+'px; font-size:2em; color: black; line-height:1em; height:2.5em; background:transparent;  text-align: left; padding: 20px 20px 20px 20px; " ></span>';

		$('#div_chat').append( span_espaco );
		
		document.body.scrollTop = document.body.scrollHeight;

		document.getElementById('mensagem_escrita').value = '';
		
		startRequest_chat_envia(msg);
		
		id = id + 1;
		
	}//fim do if
	*/
	
}

</script>
	
	
	<div id="menu">

	</div>	
			
	<script> 
		$(function(){
		  $("#menu").load("menu_fixo.html"); 
		});
	</script> 	
<!--	
  <div style=" position:fixed; width: 100%; background-color: #0054a6; top:0em; left:0%; height: 3em;" ></div> 
  <div style="width: 100%;" ><img id ="foto_perfil_chat" src="https://s3-sa-east-1.amazonaws.com/figuras-acheloja-site/pessoal_old.png" style="position: fixed; left: 3%; top:0.1em; width:2.8em; height:2.8em;"/> <span id="nome_usuario_chat" style="font-family: Montserrat;  position: fixed; font-size: 1.2em; left: 3.3em; top:0.75em; color: white; font-weight: bold; "></span></div>
-->

 <script type="text/javascript">
			var obj2;
			
			var str2;
			
			var xmlHttp2;

			function createXMLHttpRequest_pega_nome_foto_usuario_chat() {
			if (window.ActiveXObject) {
			xmlHttp2 = new ActiveXObject("Microsoft.XMLHTTP");
			}
			else if (window.XMLHttpRequest) {
			xmlHttp2 = new XMLHttpRequest();
			}
			}

			function startRequest_pega_nome_foto_usuario_chat() {
			createXMLHttpRequest_pega_nome_foto_usuario_chat();
			xmlHttp2.onreadystatechange = handleStateChange_pega_nome_foto_usuario_chat;
			
			
			xmlHttp2.open("POST", "http://54.207.38.125/AcheLoja2.0/sistematize/ajax_foto_nome_usuario_chat.php", true);
			
			
			
			xmlHttp2.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			
			//xmlHttp.send("nick_site="+localStorage.nick_site+"&id_usuario="+localStorage.id_usuario);
			xmlHttp2.send("id_usuario="+id_usuario_escolhido);
			

			
			
			}

			
			function handleStateChange_pega_nome_foto_usuario_chat() {
			if(xmlHttp2.readyState == 4) {
			if(xmlHttp2.status == 200) {
			//document.getElementById("resultado").innerHTML = xmlHttp.responseText.trim();
			//document.getElementById("verifica_login").value = xmlHttp.responseText.trim();
			
			    
				str2 = xmlHttp2.responseText.trim();
				
				obj2 = JSON.parse(str2);
			
				
				
				document.getElementById("foto_perfil_menu").src = obj2[0].foto_perfil;
				
				document.getElementById("nome_usuario").innerHTML = obj2[0].nome;
				
				if(obj2[0].foto_perfil == '') document.getElementById("foto_perfil_menu").src = "fotos/entrar_.png";
				

				
			}
			}
			}
			
		
			
		
			
</script>   

	

	
	<script> 
		$(function(){
		
		  setInterval(function(){ 
						startRequest_chat_atualiza();
		  }, 3000);
		  
		});
	</script> 		
	
	<script>
	document.addEventListener('DOMContentLoaded', function() {
		startRequest_pega_nome_foto_usuario_chat();
	}, false);
	</script>
			
	<img id="img_carregando_produtos" src="fotos/carregando_produtos.gif" style="border-radius:5px; visibility: hidden; width:40%; position: fixed; left:30%; bottom:5em;" />
	
	

	<!--
	<a href="chat.html"><img src="fotos/chat.png" width="100%"  style=" position:fixed; background-color: #0054a6; bottom:0em; left:48%; width:2.8em; height:2.8em;" /> </a>
	-->
	
	
</body>
</html>