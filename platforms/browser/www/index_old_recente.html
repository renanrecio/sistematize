<!DOCTYPE html>
<html>
<head>

 <!--
    Customize this policy to fit your own app's needs. For more guidance, see:
      https://github.com/apache/cordova-plugin-whitelist/blob/master/README.md#content-security-policy
    Some notes:
      * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
      * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
      * Disables use of inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
        * Enable inline JS: add 'unsafe-inline' to default-src
    -->
  <!-- Removing 'unsafe-eval'. If needed, I will figure out a way around it -->
 

<link rel="stylesheet" type="text/css" href="Folha_Estilo.css" media="screen" />

<style>
body
{
	background:url(fotos/fundo2.jpg);
	background-size: 100%;

}
</style>

<style>

input,
textarea {
    opacity: 0.5;
    filter: alpha(opacity=50);
	border:0px dashed;
    background-color: #0070a1;
}

::-webkit-input-placeholder {
   color: lightgray;
   font: 1em verdana, arial, sans-serif;
}

:-moz-placeholder {
   color: lightgray;
   font: 1em verdana, arial, sans-serif;
}

</style>


<title>AcheLoja</title>
</br></br>

<script>


function enviar_dados(){


if (document.getElementById('email').value == ''){

	alert('O campo E-mail está vazio, por favor preencha!');
	document.getElementById('email').focus();
	return false;

}


if (document.getElementById('senha').value == ''){

	
	alert('O campo Senha está vazio, por favor preencha!');
	document.getElementById('senha').focus();
	return false;

}

startRequest_login();

}

</script>


<!-- Verificar se é o primeiro loggin-->
<script>
if(typeof localStorage.nome_usuario === "undefined"){

localStorage.nome_usuario = '';
localStorage.id_dispositivo = '';
localStorage.cep_bairro = '';
localStorage.cidade = '';
localStorage.mudou_de_usuario = '';
localStorage.id_usuario = '';


}

</script>

	
<!-- Verificar se já está logado-->
<script>

var nome_usuario_guardado = localStorage.nome_usuario;

if( (nome_usuario_guardado != '') && (typeof nome_usuario_guardado !== "undefined") ){

	window.location.href="home.html";
	exit();
	
}else{

	localStorage.id_dispositivo = '';
	localStorage.cep_bairro = '';
	localStorage.cidade = '';

}

			
</script>	



</head>
    <!-- <body style="position: absolute; width:96%; height:auto; top:0%; left:0%;">-->
	<body class="theme-green">
 
  <!-- Views -->
  <div class="views">
    <!-- Your main view, should have "view-main" class -->
    <div class="view view-main">

			  
	<div id="tela" style="position:absolute; width:100%; height:auto; top:0em; left:0%;">
		
		<img style="position:absolute; width:80%; top:8%; left:10%;" src="fotos/logo2.png" />
		
		<form action="">
				<input id="email" name="email" type="text" style="position: absolute; top:18%; left:5%; height: 5%; width:90%;  font-size:1.5em; color:white;"   placeholder=" E-mail" />
				<input id="senha" name="senha" type="password" style="position: absolute; top:25%; left:5%; height: 5%; width:90%;  font-size:1.5em; color:white;"  placeholder=" Senha" />		
		</form>
		
		<input onclick="enviar_dados()" type="submit" style="position: absolute; top:32%; left:5%; height: 5%; width:90%;  font-weight: bold; color:white; background-color: #0070a1; font-size:1.5em; cursor: pointer; border-radius: 5px; opacity: 1; filter: alpha(opacity=100);" Value="Entrar"/>
			
		<a href="recuperar_senha.html"><span style="position:absolute; top:40%; width:80%; left:10%; "> Esqueceu a senha? Clique aqui...</span></a>
		
		<hr style="position:absolute; top:45%; width:80%; left:10%;"/>
		
		<a href="cadastrar.html" style="text-decoration:none;"><span style="position:absolute; top:50%; width:80%; left:10%; color:#0070a1; font-weight: bolder; font-size:1.1em;"> Não possui Cadastro? </br>Clique aqui para se Cadastrar...</span></a>
		
	
		<!--
	
		<img style="position:absolute; width:80%; top:15%; left:10%;" src="fotos/logo2.png" />
		
		<form action="">
				<input id="email" name="email" type="text" style="position: absolute; top:30%; left:5%; height: 7%; width:90%;  font-size:1.5em; color:white;"   placeholder=" E-mail" />
				<input id="senha" name="senha" type="password" style="position: absolute; top:40%; left:5%; height: 7%; width:90%;  font-size:1.5em; color:white;"  placeholder=" Senha" />		
		</form>
		
		<input onclick="enviar_dados()" type="submit" style="position: absolute; top:50%; left:5%; height: 7%; width:90%;  font-weight: bold; color:white; background-color: #0070a1; font-size:1.5em; cursor: pointer; border-radius: 5px; opacity: 1; filter: alpha(opacity=100);" Value="Entrar"/>
			
		<a href="recuperar_senha.html"><span style="position:absolute; top:60%; width:80%; left:10%; "> Esqueceu a senha? Clique aqui...</span></a>
		
		<hr style="position:absolute; top:70%; width:80%; left:10%;"/>
		
		<a href="cadastrar.html" style="text-decoration:none;"><span style="position:absolute; top:77%; width:80%; left:10%; color:#0070a1; font-weight: bolder; font-size:1.1em;"> Não possui Cadastro? </br>Clique aqui para se Cadastrar...</span></a>
		
		-->

		</div>
  </div>

<!-- Validação do forumlário -->
<script type="text/javascript">
			var xmlHttp;

			function createXMLHttpRequest_login() {
			if (window.ActiveXObject) {
			xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			else if (window.XMLHttpRequest) {
			xmlHttp = new XMLHttpRequest();
			}
			}

			function startRequest_login() {
			createXMLHttpRequest_login();
			xmlHttp.onreadystatechange = handleStateChange_login;
			
			
			xmlHttp.open("POST", "https://acheloja.com/m/login_app.php", true);
			xmlHttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
			
			xmlHttp.send("email=" + document.getElementById("email").value  + "&senha=" + document.getElementById("senha").value);
			
			
			
			document.getElementById("img_carregando").style.visibility = "visible";
			
			}

			
			function handleStateChange_login() {
			if(xmlHttp.readyState == 4) {
			if(xmlHttp.status == 200) {
			//document.getElementById("resultado").innerHTML = xmlHttp.responseText.trim();
			//document.getElementById("verifica_login").value = xmlHttp.responseText.trim();
			
				var str = xmlHttp.responseText.trim();
				
				str = str.trim();
				
				if(str == '0'){
				
					alert("E-mail e senha não conferem!Tente novamente! =D");
				
				}
				
				if(str == "adm"){
				
					alert("Você possui cadastro como administrador, esse App é somente para Usuários. Para acessar como ADM entre pelo site acheloja.com!");
				
				}
				
				if(str == "lojista"){
					
					alert("Você possui cadastro como Lojista, esse App é somente para Usuários. Para acessar como Lojista entre pelo site acheloja.com! Obrigado!");
				
				}
			
				//alert(str);
				
				if( (str != '0') && (str != "adm") && (str != "lojista") ){
				
						
						
						var pos_id = str.indexOf("#id");
						var pos_nome = str.indexOf("#nome");
						var pos_foto = str.indexOf("#foto");
						var pos_email = str.indexOf("#email"); 
						
						
						//alert(str);
						
						if( (str.substring((pos_id+3), pos_nome)) != (localStorage.id_usuario) ){ 
						
							localStorage.mudou_de_usuario = "1";
							
						}else{
							
							localStorage.mudou_de_usuario = "0";
						
						}
						
						localStorage.id_usuario = str.substring((pos_id+3), pos_nome);
						localStorage.nome_usuario = str.substring((pos_nome+5), pos_foto);
						localStorage.foto_usuario = str.substring((pos_foto+5), pos_email);
						localStorage.email_usuario = str.substring((pos_email+6), str.length);

						//form[0].submit;
						window.location.href="home.html";
							
							
				}//fim do if
				
				
				document.getElementById("img_carregando").style.visibility = "hidden";
				
			}else{
				alert('Sem internet');
			}
			}
			}
			
		
		
			
			
</script>    		
		



 <img id="img_carregando" style="position:fixed; top:0%; left:0%; border: 7px solid black; position:fixed;   width:100%; height:100%; opacity: 0.8; filter: alpha(opacity=80); visibility:hidden; " src="fotos/carregando.gif" />	
			
</div>		

<script>
			var windowHeight = screen.height;
			document.getElementById('tela').style.height = windowHeight + "px";
			//alert(windowHeight);
</script>	

	
</body>


		<!-- repete para garantir o tamanho certo da tela-->
		<script>
			//var windowHeight = window.innerHeight;
			//document.getElementsByTagName('body')[0].style.height = windowHeight + "px";
			//alert(windowHeight);
		</script>	
	
</html>